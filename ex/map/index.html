
<!DOCTYPE html>
<html lang="en">
<head>
    <title>Rising World Map Example</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

    <style>
        body {
            margin: 0;
            -moz-user-select: -moz-none;
            -khtml-user-select: none;
            -webkit-user-select: none;
        }
    </style>

    <script src="scenejs.js"></script>
    <script src="jquery.js"></script>

<body>

<div id="infoDark">
</div>

<script>

$.getJSON( "data.json", function(data) {

  var cidx = {};
  var pos = [];
  var indices = [];
  var p = 0;

  $.each(data['Chunks'],function(i,c){
    var x = c[0];
    var y = c[1];
    var z = c[2];
    if (!cidx[x]) {
      cidx[x] = {};
    }
    if (!cidx[x][y]) {
      cidx[x][y] = {};
    }
    var cur = p++;
    cidx[x][y][z] = cur;
    pos.push(x);
    pos.push(y);
    pos.push(z);
    if (z+1 in cidx[x][y]) {
      indices.push(cur,cidx[x][y][z+1]);
    }
    if (z-1 in cidx[x][y]) {
      indices.push(cur,cidx[x][y][z-1]);
    }
    if (cidx[x+1] && cidx[x+1][y]) {
      if (z in cidx[x+1][y]) {
        indices.push(cur,cidx[x+1][y][z]);
      }
    }
    if (cidx[x-1] && cidx[x-1][y]) {
      if (z in cidx[x-1][y]) {
        indices.push(cur,cidx[x-1][y][z]);
      }
    }
    if (cidx[x][y+1]) {
      if (z in cidx[x][y+1]) {
        indices.push(cur,cidx[x][y+1][z]);
      }
    }
    if (cidx[x][y-1]) {
      if (z in cidx[x][y-1]) {
        indices.push(cur,cidx[x][y-1][z]);
      }
    }
  });

  var widx = {};
  var wpos = [];
  var windices = [];
  var wp = 0;

  $.each(data['Worldchunks'],function(i,c){
    var x = c[0];
    var y = 0;
    var z = c[1];
    if (!widx[x]) {
      widx[x] = {};
    }
    if (!widx[x][y]) {
      widx[x][y] = {};
    }
    var cur = wp++;
    widx[x][y][z] = cur;
    wpos.push(x);
    wpos.push(y);
    wpos.push(z);
    if (z+1 in widx[x][y]) {
      windices.push(cur,widx[x][y][z+1]);
    }
    if (z-1 in widx[x][y]) {
      windices.push(cur,widx[x][y][z-1]);
    }
    if (widx[x+1] && widx[x+1][y]) {
      if (z in widx[x+1][y]) {
        windices.push(cur,widx[x+1][y][z]);
      }
    }
    if (widx[x-1] && widx[x-1][y]) {
      if (z in widx[x-1][y]) {
        windices.push(cur,widx[x-1][y][z]);
      }
    }
  });


  SceneJS.setConfigs({
    pluginPath: "scenejsplugins"
  });

  SceneJS.createScene({
    nodes: [{
      type: "cameras/orbit",
      yaw: 30,
      pitch: -30,
      zoom: 30,
      zoomSensitivity: 5.0,
      nodes: [{
        type: "material",
        color: { r:1, g:0, b:0 },
        nodes: [{
          type: "geometry",
          primitive: "lines",
          positions: pos,
          indices: indices
        }]
      },{
        type: "material",
        color: { r:0, g:1, b:0 },
        nodes: [{
          type: "geometry",
          primitive: "lines",
          positions: wpos,
          indices: windices
        }]        
      }]
    }]
  });

});

</script>
</body>
</html>